{% extends 'layout.html' %}
{% block title %}WHS Golf{% endblock %}
{% block content %}
<h1 class="mb-3">Liste des Tours</h1>
{% if new_index is not none %}
<p class="text-center fw-bold">Nouvel Index: {{ new_index }}</p>
{% endif %}
<div class="table-responsive">
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>N°</th>
            <th>Nom</th>
            <th>Jour</th>
            <th>Date</th>
            <th><span title="Ajustement des conditions de jeu automatique calculé par la FFGolf, valeur entre -1 et +3.">PCC</span></th>
            <th>Golf</th>
            <th>Total Score</th>
            <th>Total SBA</th>
            <th>Diff WHS</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for tour in tours %}
        <tr>
            <td>{{ tour.recent_no if tour.recent_no is not none else '' }}</td>
            <td>{{ tour.name }}</td>
            <td>{{ tour.jour }}</td>
            <td>{{ tour.date }}</td>
            <td>{{ tour.pcc if tour.pcc is not none else 0 }}</td>
            <td>
                {% set g = golfs.get(tour.golf_id) %}
                {{ g.name if g }}
            </td>
            <td>{{ tour.total_score if tour.total_score is not none else '' }}</td>
            <td>{{ tour.total_sba if tour.total_sba is not none else '' }}</td>
            <td{% if tour.highlight_diff %} class="best-diff"{% endif %}>{{ tour.diff_whs if tour.diff_whs is not none else '' }}</td>
            <td>
                <a class="btn btn-sm btn-secondary" href="{{ url_for('add_tour', id=tour.doc_id) }}">Modifier</a>
                <form action="{{ url_for('delete_tour', tour_id=tour.doc_id) }}" method="post" class="d-inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Supprimer ce tour ?');">Supprimer</button>
                </form>
                {% if tour.has_score %}
                <a class="btn btn-sm btn-primary" href="{{ url_for('view_score', tour_id=tour.doc_id) }}">Voir Carte</a>
                <a class="btn btn-sm btn-secondary" href="{{ url_for('add_score', tour_id=tour.doc_id) }}">Éditer Carte</a>
                {% else %}
                <a class="btn btn-sm btn-primary" href="{{ url_for('add_score', tour_id=tour.doc_id) }}">Ajouter Carte</a>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr><td colspan="10">Aucun tour enregistré.</td></tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
