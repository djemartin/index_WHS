<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% if tour %}Modifier le Tour{% else %}Ajouter un Tour{% endif %}</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header>
    <nav>
        <a href="/">Accueil</a>
        <a href="/golf">Gérer les Golfs</a>
    </nav>
</header>
<main>
    <h1>{% if tour %}Modifier le Tour{% else %}Ajouter un Tour{% endif %}</h1>
    <form method="post">
        {% if tour %}
        <input type="hidden" name="id" value="{{ tour.doc_id }}">
        {% endif %}
        <label>Nom du Tour <input type="text" name="name" value="{{ tour.name if tour else '' }}" required></label><br>
        <label>Jour <input type="number" name="jour" step="1" value="{{ tour.get('jour') if tour else '' }}" required></label><br>
        <label>Golf joué
            <select name="golf" id="golf_select" required>
                <option value="">--Choisir--</option>
                {% for g in golfs %}
                <option value="{{ g.doc_id }}" {% if tour and tour.golf_id == g.doc_id %}selected{% endif %}>{{ g.name }}</option>
                {% endfor %}
            </select>
            <a href="/golf">+</a>
        </label><br>
        <label>Par du parcours <input type="number" name="par" step="1" value="{{ tour.par if tour else '' }}" required></label><br>
        <label>Slope <input type="number" name="slope" step="1" value="{{ tour.slope if tour else '' }}" required></label><br>
        <label>SSS <input type="number" name="sss" step="0.1" value="{{ tour.sss if tour else '' }}" required></label><br>
        <h2>Par par trou</h2>
        <table>
            <thead>
                <tr>
                    <th>Trou</th>
                    <th>Par</th>
                </tr>
            </thead>
            <tbody>
                {% for i in range(1, 19) %}
                <tr>
                    <td>{{ i }}</td>
                    <td><input type="number" name="par_{{ i }}" step="1" value="{{ tour.pars[i-1] if tour and tour.pars else '' }}" required></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit">Enregistrer</button>
        {% if tour %}
        <a href="{{ url_for('add_tour') }}">Annuler</a>
        {% endif %}
    </form>
</main>
<script>
    const golfData = {{ golfs_json|tojson }};
    function updateGolfInfo(id){
        const g = golfData.find(x => x.doc_id == id);
        if(!g) return;
        document.querySelector('input[name="par"]').value = g.par;
        document.querySelector('input[name="slope"]').value = g.slope;
        document.querySelector('input[name="sss"]').value = g.sss;
    }
    document.addEventListener('DOMContentLoaded', function(){
        const select = document.getElementById('golf_select');
        if(select){
            select.addEventListener('change', function(){
                updateGolfInfo(parseInt(this.value));
            });
            if(select.value){
                updateGolfInfo(parseInt(select.value));
            }
        }
    });
</script>
</body>
</html>
